<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>HomeMetric</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            height: 100vh;
            /* Full viewport height */
        }

        .container {
            width: 40%;
            /* Adjusted for side-by-side layout */
            padding: 20px;
            overflow-y: auto;
            /* Adds scroll to the form if needed */
        }

        #map {
            width: 60%;
            /* Adjusted for side-by-side layout */
            height: 100vh;
            /* Full viewport height */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            align-items: left;
            /* Centers the children (label, input, select) */
            margin-bottom: 15px;
        }

        label {
            margin-bottom: 5px;
            width: 100%;
            /* Ensures label takes full width of form-group */
            text-align: left;
            /* Aligns the label text to the left */
        }

        input[type="text"],
        input[type="number"],
        select,
        button {
            width: calc(80% - 16px);
            /* Adjusts width and accounts for padding */
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            padding: 10px;
            background-color: #87CEEB;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #4682B4;
        }

        footer {
            text-align: left;
            padding: 20px;
            background-color: #e7e7e7;
            border-top: 1px solid #ddd;
        }

        footer p {
            margin: 0;
        }

        footer a {
            color: #0056b3;
        }

        footer a:hover {
            text-decoration: underline;
        }

        marker {
            background-color: white;
        }

        .highlighted-marker {
            background-color: black;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>HomeMetric</h1>
        <div class="form-group">
            <label for="locationInput">Location</label>
            <input type="text" id="locationInput" placeholder="Enter location">
        </div>
        <div class="form-group">
            <label for="priceRange">Price Range</label>
            <select id="priceRange">
                <option value="">Select Price Range</option>
                <option value="0-1000">$0 - $1000</option>
                <option value="1000-1500">$1000 - $1500</option>
                <option value="1500-2000">$1500 - $2000</option>
                <option value="2000-3000">$2000 - $3000</option>
                <option value="3000+">$3000+</option>
            </select>
        </div>
        <div class="form-group">
            <label for="propertyType">Property Type</label>
            <select id="propertyType">
                <option value="">Select Property Type</option>
                <option value="Apartment">Apartment</option>
                <option value="House">House</option>
                <option value="Condo">Condo</option>
                <option value="Townhome">Townhome</option>
            </select>
        </div>
        <div class="form-group">
            <label for="beds">Beds</label>
            <select id="beds">
                <option value="">Select Beds</option>
                <option value="Any">Any</option>
                <option value="Studio">Studio</option>
                <option value="1+">1+</option>
                <option value="2+">2+</option>
                <option value="3+">3+</option>
            </select>
        </div>
        <div class="form-group">
            <label for="baths">Baths</label>
            <select id="baths">
                <option value="">Select Baths</option>
                <option value="Any">Any</option>
                <option value="1+">1+</option>
                <option value="2+">2+</option>
                <option value="3+">3+</option>
            </select>
        </div>
        <div class="form-group date-input">
            <label for="startDate">Start Date</label>
            <div class="input-group">
                <input type="date" id="startDate" class="date-picker">
                <label for="flexibleStartDate" class="checkbox-label">
                    <input type="checkbox" id="flexibleStartDate" class="checkbox">
                    Flexible
                </label>
            </div>
        </div>
        <div class="form-group date-input">
            <label for="endDate">End Date</label>
            <div class="input-group">
                <input type="date" id="endDate" class="date-picker">
                <label for="flexibleEndDate" class="checkbox-label">
                    <input type="checkbox" id="flexibleEndDate" class="checkbox">
                    Flexible
                </label>
            </div>
        </div>
        <div class="form-group">
            <button onclick="fetchProperties()">Search</button>
        </div>

        <footer>
            <p>Learn more about our <a href="livability-score.html">Livability Score</a>.</p>
        </footer>

    </div>
    <div id='map'></div>
    <div id="propertyList"></div>

    <script src="send.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYW5uaWV6bWUxMiIsImEiOiJjbHMxNzR0eGIwNjI4MmlvOTRlbDR5cnliIn0.Py0zGq-Mb40HIegPUXznEw';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/outdoors-v12',
            center: [-71.0589, 42.3601], // Longitude, Latitude of Boston
            zoom: 12
        });

        function displayMap(properties) {
            if (properties.length > 0) {
                map.flyTo({
                    center: [properties[0].location[1], properties[0].location[0]], // [longitude, latitude]
                    essential: true
                });

                properties.forEach(property => {
                    const marker = new mapboxgl.Marker()
                        .setLngLat(property.location)
                        .addTo(map);

                    // Attach click event listener to the marker
                    marker.getElement().addEventListener('click', () => {
                        // Highlight the marker (you can customize this)
                        marker.getElement().classList.add('highlighted-marker');

                        // Remove highlight from other markers
                        properties.forEach(p => {
                            if (p !== property) {
                                // Find marker element and remove highlight
                                map.getCanvas().querySelectorAll('.mapboxgl-marker').forEach(el => {
                                    if (el.getAttribute('data-name') === p.name) {
                                        el.classList.remove('highlighted-marker');
                                    }
                                });
                            }
                        });
                    });
                });
            }
        }


        function displayRecommendations(properties) {
            const propertyList = document.getElementById('propertyList');
            propertyList.innerHTML = ''; // Clear current list

            properties.forEach(property => {
                const googleSearchURL = `https://www.google.com/search?q=site:${encodeURIComponent(property.link)}+${encodeURIComponent(property.name)}`;
                const element = document.createElement('div');
                element.classList.add('property-item');
                element.innerHTML = `
                    <h3>${property.name}</h3>
                    <p>${property.description}</p>
                    <p>Location: ${property.neighborhood}</p>
                    <p>Price: ${property.price}</p>
                    <a href="${property.link}" target="_blank" class="view-listing-btn">View Listing</a>
                `;
                propertyList.appendChild(element);
            });
        }

    </script>
</body>

</html>